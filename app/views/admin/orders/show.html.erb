<h1>注文履歴詳細</h1>

<h4>購入者</h4>
<%= link_to admin_customer_path(@order.customer_id) do %>
	<%= @order.customer.full_name %>
<% end %>

<h4>注文日</h4>
<%= @order.created_at.strftime("%Y/%m/%d") %>

<h4>配送先</h4>
〒<%= @order.postal_code %>
<%= @order.address %>
<%= @order.name %>

<h4>支払方法</h4>
<%= @order.payment_method_i18n %>

<h4>注文ステータス</h4>
<%= form_with model: @order, url: admin_order_path(@order.id) do |f| %>
	<%= f.select :status, Order.statuses_i18n.invert %>
	<%= f.submit '更新', class: "btn btn-success" %>
<% end %>

<table class="table table-borderless">
	<thead class="thead-light">
		<tr>
			<th>商品名</th>
			<th>単価(税込)</th>
			<th>数量</th>
			<th>小計</th>
			<th>製作ステータス</th>
		</tr>
	</thead>
	<tbody>
		<% @order.order_details.each do |order_detail| %>
		<tr>
			<td><%= order_detail.item.name %></td>
			<td><%= order_detail.item.with_tax_price.to_s(:delimited) %></td>
			<td><%= order_detail.amount %></td>
			<td><%= order_detail.subtotal.to_s(:delimited) %></td>
			<td>
				<%= form_with model: order_detail, url: admin_order_detail_path(order_detail.id), method: :patch do |f| %>
					<%= f.select :making_status, OrderDetail.making_statuses_i18n.invert %>
					<%= f.hidden_field :order_detail_id, :value => order_detail.id %>
					<%= f.submit '更新', class: "btn btn-success" %>
				<% end %>
			</td>
		</tr>
		<% end %>
	</tbody>
</table>

<h4>商品合計</h4>
<%= @order.total_cost.to_s(:delimited) %>

<h4>送料</h4>
<%= @order.shipping_cost %>

<h4>請求金額合計</h4>
<%= @order.total_payment.to_s(:delimited) %>